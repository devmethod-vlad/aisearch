COMPOSE_PATH_SEPARATOR=';'
COMPOSE_FILE='docker-compose.yml;docker-compose.prod.yml'

LOGS_HOST_DIR=./logs
LOGS_CONTR_DIR=/usr/src/logs
LOGS_ACCESS_LOCATION=/app/access.log

CUDA_IMAGE=nvidia/cuda:12.8.0-devel-ubuntu22.04
CUDA_WHEEL=cu128
HTTPS_PROXY_ENV=''
HTTP_PROXY_ENV=''
IMAGE_NAME_BASE=cuda-python-uv-base:latest
IMAGE_NAME_DEPS=aisearch-deps-base:latest
IMAGE_NAME=aisearch-app-dev:latest
REGISTRY=localhost:5001

APP_MODE=dev
APP_HOST=0.0.0.0
APP_PORT=5155
APP_DEBUG_HOST=0.0.0.0
APP_DEBUG_PORT=5678
APP_WORKERS_NUM=2
APP_ACCESS_KEY=123
APP_PREFIX=

APP_LOGS_LOCATION=app/app.log
APP_LOG_LEVEL=INFO

APP_USE_CACHE=false
# Нормализовать ли запрос
APP_NORMALIZE_QUERY=false
APP_COLLECTION_FILES_HOST_DIR=./collections
APP_COLLECTION_FILES_CONTR_DIR=/collections

APP_DATA_UNIQUE_ID=ext_id
APP_RECREATE_DATA=true
APP_GENERATE_PRELAUNCH_DATA=true
APP_PRELAUNCH_DATA_HOST_DIR=./prelaunch
APP_PRELAUNCH_DATA_CONTR_DIR=/prelaunch

APP_MODELSTORE_HOST_PATH=./models
APP_MODELSTORE_CONTR_PATH=/usr/src/models

NLTK_DATA_HOST_PATH=./nltk
NLTK_DATA_CONTR_PATH=/srv/nltk_data

SLOWAPI_LIMIT_SEARCH=200/minute
SLOWAPI_LIMIT_GENERATE=20/minute

# periodic
ETCD_AUTO_COMPACTION_MODE=revision
# time, like "1h"
ETCD_AUTO_COMPACTION_RETENTION=1000
ETCD_QUOTA_BACKEND_BYTES=4294967296
ETCD_SNAPSHOT_COUNT=50000
ETCD_HOST=aisearch-etcd
ETCD_PORT=2379
ETCD_VOLUME_HOST_PATH=./volumes/etcd
ETCD_VOLUME_CONTR_PATH=/etcd

MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_HOST=aisearch-minio
MINIO_WEB_UI_PORT=9001
MINIO_BUCKET_NAME=aisearch-bucket
MINIO_PORT=9000
MINIO_VOLUME_HOST_PATH=./volumes/minio
MINIO_VOLUME_CONTR_PATH=/minio_data

MILVUS_HOST=aisearch-milvus
MILVUS_PORT=19530
MILVUS_USE_SSL=false
MILVUS_WEB_UI_PORT=9091
MILVUS_CONNECTION_TIMEOUT=120
MILVUS_QUERY_TIMEOUT=30
MILVUS_METRIC_TYPE=IP
MILVUS_COLLECTION_NAME=kb_default
MILVUS_VECTOR_FIELD=embedding
MILVUS_ID_FIELD=pk
MILVUS_SEARCH_FIELDS=question
MILVUS_OUTPUT_FIELDS=row_idx,source,ext_id,page_id,role,component,product,actual,second_line,question,question_md,analysis,analysis_md,answer,answer_md,for_user,jira,modified_at
MILVUS_VOLUME_HOST_PATH=./volumes/milvus
MILVUS_VOLUME_CONTR_PATH=/var/lib/milvus
MILVUS_MODEL_NAME=USER-bge-m3
MILVUS_SCHEMA_PATH=app/settings/conf.json

# === Очередь LLM (для отложенной генерации, если нет слота семафора) ===
LLM_QUEUE_LIST_KEY=llm:queue:list
LLM_QUEUE_TICKET_HASH_PREFIX=llm:ticket:
LLM_QUEUE_MAX_SIZE=10
LLM_QUEUE_TICKET_TTL=3600
LLM_QUEUE_DRAIN_INTERVAL_SEC=1

# === Переключатели поиска ===
# если false -> только dense + (опц.) reranker
SEARCH_USE_HYBRID=true
# взаимоисключимо с BM25 (приоритет OS)
SEARCH_USE_OPENSEARCH=true
SEARCH_USE_BM25=false
SEARCH_USE_RERANKER=true

SHORT_DENSE_TOP_K=30
SHORT_LEX_TOP_K=20
SHORT_TOP_K=5
SHORT_W_CE=0.0
SHORT_W_DENSE=0.3
SHORT_W_LEX=0.7
SHORT_USE_HYBRID=true
SHORT_USE_OPENSEARCH=true
SHORT_USE_BM25=false
SHORT_USE_RERANKER=false
SHORT_MODE=true
SHORT_MODE_LIMIT=3

# === Параметры гибридного склейщика ===
HYBRID_DENSE_TOP_K=50
HYBRID_LEX_TOP_K=20
HYBRID_TOP_K=10
# 0.6 0.25 0.15
HYBRID_W_CE=0.3
HYBRID_W_DENSE=0.55
HYBRID_W_LEX=0.15
HYBRID_CACHE_TTL=3600
HYBRID_VERSION=v1
HYBRID_COLLECTION_NAME=kb_default
HYBRID_MERGE_BY_FIELD=ext_id
HYBRID_MERGE_FIELDS=row_idx,source,ext_id,page_id,role,component,product,actual,second_line,question,question_md,analysis,analysis_md,answer,answer_md,for_user,jira,modified_at
HYBRID_OUTPUT_FIELDS=row_idx,source,ext_id,page_id,role,component,product,actual,second_line,question,question_md,analysis,analysis_md,answer,answer_md,for_user,jira,modified_at
HYBRID_DENSE_ABS_MIN=0.25
HYBRID_DENSE_REL_MIN=0.6
HYBRID_LEX_REL_MIN=0.5
HYBRID_PRECUT_MIN_KEEP=3

HYBRID_ENABLE_INTERMEDIATE_RESULTS=true
HYBRID_INTERMEDIATE_RESULTS_TOP_K=5

# === OpenSearch ===
OS_HOST=aisearch-opensearch
OS_PORT=9200
OS_INDEX_NAME=aisearch-qa
OS_USE_SSL=false
OS_VERIFY_CERTS=false
OS_USER=
OS_PASSWORD=
# OS_QUERY_PROFILE=fast
OS_SEARCH_FIELDS=question
OS_OUTPUT_FIELDS=row_idx,source,ext_id,page_id,role,component,product,actual,second_line,question,question_md,analysis,analysis_md,answer,answer_md,for_user,jira,modified_at
OS_OPERATOR=or
OS_MIN_SHOULD_MATCH=1
OS_FUZZINESS=0
OS_USE_RESCORE=false
OS_INDEX_ANSWER=false
OS_BULK_CHUNK_SIZE=1000
OS_SCHEMA_PATH=app/settings/os_index.json
OS_VOLUME_HOST_PATH=./volumes/opensearch-data
OS_VOLUME_CONTR_PATH=/usr/share/opensearch/data

REDIS_HOSTNAME=redis
REDIS_PORT=6379
REDIS_DATABASE=7

REDISINSIGHT_PORT=6399

CELERY_LOGS_LOCATION=/celery/celery.log
CELERY_LOG_LEVEL=INFO
CELERY_LOGS_QUEUE_LOCATION=/queue/queue.log
CELERY_LOG_QUEUE_LEVEL=INFO
CELERY_WORKERS_NUM=1
CELERY_GRACE_PERIOD_SECONDS=30

# === Глобальный семафор (общий лимит конкаренси для поиска и генерации) ===
LLM_GLOBAL_SEM_REDIS_DSN="redis://${REDIS_HOSTNAME}:${REDIS_PORT}/${REDIS_DATABASE}"
LLM_GLOBAL_SEM_KEY=llm:{global}:sem
LLM_GLOBAL_SEM_LIMIT=2
LLM_GLOBAL_SEM_TTL_MS=120000
LLM_GLOBAL_SEM_WAIT_TIMEOUT_MS=30000
LLM_GLOBAL_SEM_HEARTBEAT_MS=30000

# === CrossEncoder (reranker) ===
# или cuda
RERANKER_DEVICE=cuda
RERANKER_BATCH_SIZE=54
RERANKER_MAX_LENGTH=512
RERANKER_DTYPE=fp16
RERANKER_SCORE_MOD=sigmoid
RERANKER_SOFTMAX_TEMP=0.7
RERANKER_MODEL_NAME=cross-encoder-russian-msmarco
# question,analysis,answer
RERANKER_PAIRS_FIELDS=question

# === Прогрев эмбеддера/реранкера при старте ===
WARMUP_ENABLED=true
WARMUP_CE_PAIRS="Как оформить доступ в систему?||Как оформить доступ врача в систему?;Запись к врачу||Как записаться к врачу"
WARMUP_EMBED_TEXTS="Пример вопроса один;Пример вопроса два"

# включить логгирование времени
TIMEIT_LOG_METRICS_ENABLED=true
TIMEIT_RESPONSE_METRIC_ENABLED=true

NLTK_DATA=./nltk

EXTRACT_EDU_EMIAS_URL="https://edu.example.com"
#EXTRACT_EDU_EMIAS_TOKEN=
EXTRACT_EDU_EMIAS_ATTACHMENTS_PAGE_ID=191032284
EXTRACT_KNOWLEDGE_BASE_FILE_NAME="KB_wiki.xlsx"
EXTRACT_VIO_BASE_FILE_NAME="Вопросы_и_ответы.xlsx"
EXTRACT_CRON_UPDATE_TIMES="22:20"
EXTRACT_EDU_TIMEOUT=20
EXTRACT_BASE_HARVESTER_API_URL="https://https://edu.example.com/edu-rest-api/test/data-harvester"
EXTRACT_KB_HARVESTER_SUFFIX="/knowledge-base/collect-all"
EXTRACT_VIO_HARVESTER_SUFFIX="/vio/runtime_harvest"
EXTRACT_LOGS_LOCATION=/updater/updater.log
EXTRACT_LOG_LEVEL=INFO

# === PosgreSQL ===
POSTGRES_USER=postgres
POSTGRES_PASSWORD=root
POSTGRES_HOST=postgresdb
POSTGRES_PORT=5432
POSTGRES_DB=aisearch
POSTGRES_VOLUME_HOST_PATH=./volumes/pgdata
POSTGRES_VOLUME_CONTR_PATH=/var/lib/postgresql/data

PGADMIN_DEFAULT_EMAIL=pgadmin@example.com
#PGADMIN_DEFAULT_PASSWORD=
PGADMIN_PORT=5050